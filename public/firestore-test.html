<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Firestore Connection Test</title>
  <style>
    body { font-family: sans-serif; padding: 1em; }
    #output { margin-top: 1em; }
  </style>
</head>
<body>
  <h1>Firestore Connection Test</h1>
  <button id="testButton">Run Test</button>
  <pre id="output"></pre>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js';
    import { initializeFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyAsg49ymxVQYoHzWJPFrYCE6E0pjGd54aI",
      authDomain: "stocks-c40b4.firebaseapp.com",
      projectId: "stocks-c40b4",
      storageBucket: "stocks-c40b4.firebasestorage.app",
      messagingSenderId: "40268119136",
      appId: "1:40268119136:web:cf226f44f801c53087d705",
    };

    const app = initializeApp(firebaseConfig);
    const db = initializeFirestore(app, {
      experimentalForceLongPolling: true,
      useFetchStreams: false,
    });

    async function checkFirestoreConnection() {
      const pingRef = doc(db, 'connectionTest', 'ping');
      try {
        await setDoc(pingRef, { time: Date.now() });
        const snap = await getDoc(pingRef);
        return snap.exists();
      } catch (err) {
        console.error('Connection failed', err);
        return false;
      }
    }

    document.getElementById('testButton').addEventListener('click', async () => {
      document.getElementById('output').textContent = 'Running...';
      const ok = await checkFirestoreConnection();
      document.getElementById('output').textContent = ok ? 'Connection successful' : 'Connection failed';
    });
  </script>
</body>
</html>
